script "com.bakersast.uistacks.card"command _resetUI  set the dvData of group "Stacks" to empty  set the text of image "Preview" to empty  set the rect of image "Preview" to the rect of button "Preview"  show field "Preview"  lock messages  set the menuHistory of button "UIType" to 1  unlock messagesend _resetUIon preOpenCard  resizeStack the width of me, the height of me  PopulateUIStacksend preOpenCardon closeCard  set the dvData of group "Stacks" to emptyend closeCardon resizeStack pWidth, pHeight  ResizeGlobalControls  set the topleft of field "LblHeading" to 20,the bottom of group "NavigationControls" + 20  set the rect of button "Preview" to 20, pHeight - (pHeight * .30), pWidth-20, pHeight - 20  set the rect of graphic "PreviewBorder" to the rect of button "Preview"  set the loc of field "Preview" to the loc of button "Preview"  _resizePreview  set the rect of group "Stacks" to 20,the bottom of field "LblHeading" + 8, pWidth-20, the top of button "Preview" - 8  set the right of button "UIType" to pWidth-20  set the top of button "UIType" to the item 2 of the loc of field "LblHeading" - (the height of button "UIType"/2)  set the topright of field "LblTypeFilter" to the topleft of button "UIType"end resizeStackprivate command _resizePreview  local tDimensions  put ScaleDimensionsToFit(the width of image "Preview", the height of image "Preview", \        the width of button "Preview", the height of button "Preview") into tDimensions  set the width of image "Preview" to item 1 of tDimensions  set the height of image "Preview" to item 2 of tDimensions  set the loc of image "Preview" to the loc of button "Preview"end _resizePreviewcommand PopulateUIStacks  local tStacksA, tUIKey  -- filename  -- key  -- name  -- encrypt  put the selectedText of button "UIType" into tUIKey  put SortArrayByKey(levureGetUIStacks(tUIKey), "name") into tStacksA  set the dvData of group "Stacks" to tStacksA  set the text of image "Preview" to emptyend PopulateUIStackscommand uiPreviewUIStack  local tSelText, tSelStackName, tSelStackFilename, tLoadedInMemory  lock screen  show field "Preview"  put the uSelectedStackName of group "Stacks" into tSelStackName  put the uSelectedStackFilename of group "Stacks" into tSelStackFilename  if tSelStackName is not empty and tSelStackFilename is not empty then    put there is a stack tSelStackName into tLoadedInMemory    export snapshot from this card of stack tSelStackFilename to image "Preview"    _resizePreview    hide field "Preview"    unlock screen    if not tLoadedInMemory then      delete stack tSelStackFilename    end if  end ifend uiPreviewUIStack